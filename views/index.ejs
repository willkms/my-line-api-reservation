<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>予約管理画面</title>
  <link rel="stylesheet" href="../liff/css/bootstrap.min.css">
  <link rel="stylesheet" href="../liff/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="../liff/scss/style.css">
  <link href="https://use.fontawesome.com/releases/v6.3.0/css/all.css" rel="stylesheet">
  <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
  <script src="../liff/js/bootstrap.min.js"></script>
  <script src="../liff/js/config.js" charset="utf-8"></script>
</head>
<body>
  <div class="container">
    <h1>予約管理画面</h1>

    <input type="month" name="month" value=<%= this_month%> min=<%= this_month%> max=<%= max_month%>>

    データ：<%= row1%><%= row2%><%= row3%><%= row4%>

    <%
    const weeks = ['日', '月', '火', '水', '木', '金', '土']
    const date = new Date()
    let year = date.getFullYear()
    let month = date.getMonth() + 1
    const config = {
        show: 3,
    }
    
    function showCalendar(year, month) {
        for ( i = 0; i < config.show; i++) {
            const calendarHtml = createCalendar(year, month)
            const sec = document.createElement('section')
            sec.innerHTML = calendarHtml
            document.querySelector('#calendar').appendChild(sec)
    
            month++
            if (month > 12) {
                year++
                month = 1
            }
        }
    }
    
    function createCalendar(year, month) {
        const startDate = new Date(year, month - 1, 1) // 月の最初の日を取得
        const endDate = new Date(year, month,  0) // 月の最後の日を取得
        const endDayCount = endDate.getDate() // 月の末日
        const lastMonthEndDate = new Date(year, month - 1, 0) // 前月の最後の日の情報
        const lastMonthendDayCount = lastMonthEndDate.getDate() // 前月の末日
        const startDay = startDate.getDay() // 月の最初の日の曜日を取得
        let dayCount = 1 // 日にちのカウント
        let calendarHtml = '' // HTMLを組み立てる変数
    
        calendarHtml += '<h1>' + year  + '/' + month + '</h1>'
        calendarHtml += '<table>'
    
        // 曜日の行を作成
        for (let i = 0; i < weeks.length; i++) {
            calendarHtml += '<td>' + weeks[i] + '</td>'
        }
    
        for (let w = 0; w < 6; w++) {
            calendarHtml += '<tr>'
    
            for (let d = 0; d < 7; d++) {
                if (w == 0 && d < startDay) {
                    // 1行目で1日の曜日の前
                    let num = lastMonthendDayCount - startDay + d + 1
                    calendarHtml += '<td class="is-disabled">' + num + '</td>'
                } else if (dayCount > endDayCount) {
                    // 末尾の日数を超えた
                    let num = dayCount - endDayCount
                    calendarHtml += '<td class="is-disabled">' + num + '</td>'
                    dayCount++
                } else {
                    calendarHtml += '<td>' + dayCount + '</td>'
                    dayCount++
                }
            }
            calendarHtml += '</tr>'
        }
        calendarHtml += '</table>'
    
        return calendarHtml
    }
    
    function moveCalendar(e) {
        document.querySelector('#calendar').innerHTML = ''
    
        if (e.target.id === 'prev') {
            month--
    
            if (month < 1) {
                year--
                month = 12
            }
        }
    
        if (e.target.id === 'next') {
            month++
    
            if (month > 12) {
                year++
                month = 1
            }
        }
    
        showCalendar(year, month)
    }
    
    document.querySelector('#prev').addEventListener('click', moveCalendar)
    document.querySelector('#next').addEventListener('click', moveCalendar)
    
    showCalendar(year, month)
    %>

    <table class="calendar">

      <tr>
        <th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th>
      </tr>

      <tr>
        <td></td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td>
      </tr>

      <tr>
        <td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td>
      </tr>

      <tr>
        <td>14</td><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td>
      </tr>

      <tr>
        <td>21</td><td>22</td><td>23</td><td>24</td><td>25</td><td>26</td><td>27</td>
      </tr>

      <tr>
        <td>28</td><td>29</td><td>30</td><td>31</td><td></td><td></td><td></td>
      </tr>

    </table>

  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>